<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Score Details</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        body {
            background-color: #F3F3F3; /* Light grey */
            color: #1B3D6D; /* Dark blue */
            font-family: 'PT Serif', serif;
        }
        h1 {
            font-family: 'Montserrat', sans-serif;
            color: #47763B; 
            margin-bottom: 30px;
            font-weight: 700;
        }
        .container {
            padding-top: 50px;
        }
        .card {
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .card-body {
            padding: 40px;
        }
        p {
            margin-bottom: 8px;
        }
        strong {
            font-weight: 600;
        }
        .title {
            color: #47763B; 
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        .info-item {
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }
        .info-item strong {
            color: #47763B; /* Dark green */
            font-weight: 600;
            display: inline-block;
            width: 200px;
        }
        .edit-form {
            display: none;
        }
        .back-button {
            position: absolute;
            top: 150px;
            left: 50px;
            z-index: 1000;
            transition: opacity 0.3s ease;
            opacity: 0.7;
        }
        .back-button:hover {
            opacity: 1;
        }
        .inline {
            display: flex;
            align-items: center;
        }

        .inline label {
            margin-right: 10px; 
        }

        .edit-form .form-group {
            margin-bottom: 20px;
        }

        .edit-form input[type="text"] {
            border: 2px solid #47763B; 
            border-radius: 5px;
            padding: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .edit-form input[type="text"]:focus {
            border-color: #1B3D6D; 
            outline: none;
        }

        .edit-form button[type="submit"] {
            background-color: #1B3D6D; 
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .edit-form button[type="submit"]:hover {
            background-color: #47763B; 
        }

        #editButton {
            background-color: #757575; 
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #editButton:hover {
            background-color: #616161; 
        }
        
    </style>
</head>
<body>

    <%- include('navbar.ejs') %>
    
    <a href="/music" class="back-button"><i class="fas fa-arrow-left" style="font-size: 2rem; color: #555;"></i></a>
    
    <div class="container">
        <h1 class="text-center title">Score Details</h1>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <div class="info-item">
                            <strong>Number:</strong> <%= score.Number %>
                        </div>
                        <div class="info-item">
                            <strong>Title:</strong> <%= score.Title %>
                        </div>
                        <div class="info-item">
                            <strong>Composer:</strong> <%= score.Composer %>
                        </div>
                        <div class="info-item">
                            <strong>Arranger:</strong> <%= score.Arranger %>
                        </div>
                        <div class="info-item">
                            <strong>Publisher:</strong> <%= score.Publisher %>
                        </div>
                        <div class="info-item">
                            <strong>Style:</strong> <%= score.Style %>
                        </div>
                        <div class="info-item">
                            <strong>Grade:</strong> <%= score.Grade %>
                        </div>
                        <div class="info-item">
                            <strong>Time:</strong> <%= score.Time %>
                        </div>
                        <div class="info-item">
                            <strong>Format:</strong> <%= score.Format %>
                        </div>
                        <div class="info-item">
                            <strong>Aux. Winds and Perc. Added:</strong>
                            <input type="checkbox" id="auxiliaryCheckbox" <%= score.AuxWindsPercAdded ? 'checked' : '' %> disabled>
                        </div>
                        <div class="info-item">
                            <strong>Notes:</strong> <%= score.Notes %>
                        </div>
                        
                        <button id="editButton" class="btn btn-secondary mb-3">Edit</button>
                        
                        <form id="editForm" class="edit-form" action="/music/<%= score._id %>/edit" method="POST">
                            <div class="form-group inline">
                                <label for="editNumber">Number:</label>
                                <input type="text" id="editNumber" name="editNumber" class="form-control" value="<%= score.Number %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editTitle">Title:</label>
                                <input type="text" id="editTitle" name="editTitle" class="form-control" value="<%= score.Title %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editComposer">Composer:</label>
                                <input type="text" id="editComposer" name="editComposer" class="form-control" value="<%= score.Composer %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editArranger">Arranger:</label>
                                <input type="text" id="editArranger" name="editArranger" class="form-control" value="<%= score.Arranger %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editPublisher">Publisher:</label>
                                <input type="text" id="editPublisher" name="editPublisher" class="form-control" value="<%= score.Publisher %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editStyle">Style:</label>
                                <input type="text" id="editStyle" name="editStyle" class="form-control" value="<%= score.Style %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editGrade">Grade:</label>
                                <input type="text" id="editGrade" name="editGrade" class="form-control" value="<%= score.Grade %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editTime">Time:</label>
                                <input type="text" id="editTime" name="editTime" class="form-control" value="<%= score.Time %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editFormat">Format:</label>
                                <input type="text" id="editFormat" name="editFormat" class="form-control" value="<%= score.Format %>">
                            </div>
                            <div class="form-group inline">
                                <label for="editAuxiliary">Auxiliary Winds and Perc. Added:</label>
                                <input type="checkbox" id="editAuxiliary" name="editAuxiliary" class="form-check-input" <%= score.AuxWindsPercAdded ? 'checked' : '' %>>
                            </div>
                            <div class="form-group inline">
                                <label for="editNotes">Notes:</label>
                                <input type="text" id="editNotes" name="editNotes" class="form-control" value="<%= score.Notes %>">
                            </div>
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" id="deleteButton" class="btn btn-danger mb-3">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this score?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button id="confirmDeleteButton" type="button" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>
    </div>

<%- include('footer.ejs') %>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editButton = document.getElementById('editButton');
        const originalInfo = document.querySelectorAll('.info-item');
        const saveButton = document.getElementById('saveButton');
        const editForm = document.getElementById('editForm');
        const deleteButton = document.getElementById('deleteButton');
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        const confirmDeleteButton = document.getElementById('confirmDeleteButton');
        const auxiliaryCheckbox = document.getElementById('auxiliaryCheckbox');

        const scoreId = '<%= score._id %>'; // Get the score ID from the rendered template

        // Show edit form when edit button is clicked
        editButton.addEventListener('click', function() {
            editButton.style.display = 'none';
            originalInfo.forEach(element => {
                element.style.display = 'none';
            });
            editForm.style.display = 'block';
            auxiliaryCheckbox.disabled = false; // Enable the checkbox for editing
        });

        // Handle delete button click
        deleteButton.addEventListener('click', function() {
            deleteModal.show();
        });

        // Handle confirm delete button click
        confirmDeleteButton.addEventListener('click', async function() {
            try {
                const response = await fetch(`/music/${scoreId}/delete`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                if (response.ok) {
                    window.location.href = '/music';
                } else {
                    console.error('Failed to delete score:', data.error);
                }
            } catch (error) {
                console.error('Error deleting score:', error);
            }
        });
    });
</script>

</body>
</html>
